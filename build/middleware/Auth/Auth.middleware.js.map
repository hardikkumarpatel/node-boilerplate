{"version":3,"file":"Auth.middleware.js","names":["_httpStatusCodes","_interopRequireWildcard","require","_index","_config","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","ACCESS_TOKEN_SECRET","process","env","useAuthMiddleware","AsyncHandlerHelper","req","res","next","cookies","headers","token","authorization","replace","ApiErrorHandler","StatusCodes","UNAUTHORIZED","getReasonPhrase","decodeToken","verifyToken","email","user","sequelize","models","User","findOne","where","dataValues","_default","exports"],"sources":["../../../src/middleware/Auth/Auth.middleware.js"],"sourcesContent":["import StatusCodes, { getReasonPhrase } from \"http-status-codes\";\nimport { ApiErrorHandler, AsyncHandlerHelper, verifyToken } from \"../../helpers/index\";\nimport { sequelize } from \"../../config\";\nconst { ACCESS_TOKEN_SECRET } = process.env;\n\nconst useAuthMiddleware = AsyncHandlerHelper(async (req, res, next) => {\n  const { cookies, headers } = req;\n  const token = cookies?.[\"token\"] || headers.authorization?.replace(\"Bearer \", \"\");\n  if (!token) {\n    throw new ApiErrorHandler(\n      StatusCodes.UNAUTHORIZED,\n      getReasonPhrase(StatusCodes.UNAUTHORIZED),\n      \"Unauthorised request! access token is missing\"\n    );\n  }\n  const decodeToken = await verifyToken(token, ACCESS_TOKEN_SECRET);\n  const { email } = decodeToken;\n  const user = await sequelize.models.User.findOne({ where: { email } });\n  if (!user) {\n    throw new ApiErrorHandler(\n      StatusCodes.UNAUTHORIZED,\n      getReasonPhrase(StatusCodes.UNAUTHORIZED),\n      \"Invalid user access token\"\n    );\n  }\n\n  req.user = user.dataValues;\n  next();\n});\n\nexport default useAuthMiddleware;\n"],"mappings":";;;;;;AAAA,IAAAA,gBAAA,GAAAC,uBAAA,CAAAC,OAAA;AACA,IAAAC,MAAA,GAAAD,OAAA;AACA,IAAAE,OAAA,GAAAF,OAAA;AAAyC,SAAAG,yBAAAC,CAAA,6BAAAC,OAAA,mBAAAC,CAAA,OAAAD,OAAA,IAAAE,CAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,CAAAC,CAAA,WAAAA,CAAA,GAAAG,CAAA,GAAAD,CAAA,KAAAF,CAAA;AAAA,SAAAL,wBAAAK,CAAA,EAAAE,CAAA,SAAAA,CAAA,IAAAF,CAAA,IAAAA,CAAA,CAAAI,UAAA,SAAAJ,CAAA,eAAAA,CAAA,uBAAAA,CAAA,yBAAAA,CAAA,WAAAK,OAAA,EAAAL,CAAA,QAAAG,CAAA,GAAAJ,wBAAA,CAAAG,CAAA,OAAAC,CAAA,IAAAA,CAAA,CAAAG,GAAA,CAAAN,CAAA,UAAAG,CAAA,CAAAI,GAAA,CAAAP,CAAA,OAAAQ,CAAA,KAAAC,SAAA,UAAAC,CAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,CAAA,IAAAd,CAAA,oBAAAc,CAAA,OAAAC,cAAA,CAAAC,IAAA,CAAAhB,CAAA,EAAAc,CAAA,SAAAG,CAAA,GAAAP,CAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAb,CAAA,EAAAc,CAAA,UAAAG,CAAA,KAAAA,CAAA,CAAAV,GAAA,IAAAU,CAAA,CAAAC,GAAA,IAAAP,MAAA,CAAAC,cAAA,CAAAJ,CAAA,EAAAM,CAAA,EAAAG,CAAA,IAAAT,CAAA,CAAAM,CAAA,IAAAd,CAAA,CAAAc,CAAA,YAAAN,CAAA,CAAAH,OAAA,GAAAL,CAAA,EAAAG,CAAA,IAAAA,CAAA,CAAAe,GAAA,CAAAlB,CAAA,EAAAQ,CAAA,GAAAA,CAAA;AACzC,MAAM;EAAEW;AAAoB,CAAC,GAAGC,OAAO,CAACC,GAAG;AAE3C,MAAMC,iBAAiB,GAAG,IAAAC,yBAAkB,EAAC,OAAOC,GAAG,EAAEC,GAAG,EAAEC,IAAI,KAAK;EACrE,MAAM;IAAEC,OAAO;IAAEC;EAAQ,CAAC,GAAGJ,GAAG;EAChC,MAAMK,KAAK,GAAGF,OAAO,GAAG,OAAO,CAAC,IAAIC,OAAO,CAACE,aAAa,EAAEC,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC;EACjF,IAAI,CAACF,KAAK,EAAE;IACV,MAAM,IAAIG,sBAAe,CACvBC,wBAAW,CAACC,YAAY,EACxB,IAAAC,gCAAe,EAACF,wBAAW,CAACC,YAAY,CAAC,EACzC,+CACF,CAAC;EACH;EACA,MAAME,WAAW,GAAG,MAAM,IAAAC,kBAAW,EAACR,KAAK,EAAEV,mBAAmB,CAAC;EACjE,MAAM;IAAEmB;EAAM,CAAC,GAAGF,WAAW;EAC7B,MAAMG,IAAI,GAAG,MAAMC,iBAAS,CAACC,MAAM,CAACC,IAAI,CAACC,OAAO,CAAC;IAAEC,KAAK,EAAE;MAAEN;IAAM;EAAE,CAAC,CAAC;EACtE,IAAI,CAACC,IAAI,EAAE;IACT,MAAM,IAAIP,sBAAe,CACvBC,wBAAW,CAACC,YAAY,EACxB,IAAAC,gCAAe,EAACF,wBAAW,CAACC,YAAY,CAAC,EACzC,2BACF,CAAC;EACH;EAEAV,GAAG,CAACe,IAAI,GAAGA,IAAI,CAACM,UAAU;EAC1BnB,IAAI,CAAC,CAAC;AACR,CAAC,CAAC;AAAC,IAAAoB,QAAA,GAAAC,OAAA,CAAA1C,OAAA,GAEYiB,iBAAiB","ignoreList":[]}